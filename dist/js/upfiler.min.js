!function () { var e = !1, t = document.getElementById("dh-uploader-form"); function n(t, n) { for (var a = "\n\n", r = t.files.length - 1; r >= 0; r--)a += t.files[r].name + ':\n <img src="' + t.files[r].url + '" alt="' + t.files[r].name + '" width="256">\n\n'; e || (a = "-------- VEDLAGTE FILER --------\n" + a), dhTarget.value = n ? "-------- VEDLAGTE FILER --------\n" + a : dhTarget.value + a, e = !0 } function a(e) { console.log("error", e) } list = document.getElementById("dh-uploader-filelist"), uploadBtn = document.getElementById("dh-uploader-btn"), input = document.getElementById("dh-uploader-input"), submitBtn = document.getElementById("dh-uploader-submit"), dhTarget = document.querySelector(".dh-uploader-target"), uploadBtn.addEventListener("click", function () { input.click() }), input.addEventListener("change", function () { submitBtn.click() }), t.addEventListener("submit", function (e) { !function (e) { e.stopPropagation(), e.preventDefault() }(e); var r = new FormData(t), i = new XMLHttpRequest; i.onreadystatechange = function () { var e = i.responseText; if (i.readyState === XMLHttpRequest.DONE && 200 == i.status) try { (e = JSON.parse(e)).success ? (!function (e) { for (var t = e.files.length - 1; t >= 0; t--) { var a = e.files[t].hash, r = document.createElement("li"), i = document.createElement("a"); i.setAttribute("id", a + "-link"), i.setAttribute("href", e.files[t].url), i.setAttribute("data-name", e.files[t].name), i.setAttribute("target", "_blank"); var l = document.createElement("p"); l.setAttribute("id", a + "-name"); var d = document.createElement("img"); d.setAttribute("src", e.files[t].thumbnail); var u = document.createElement("button"); u.innerHTML = "X", u.setAttribute("data-target", a), u.addEventListener("click", function (e) { e.preventDefault(); var t = document.getElementById(this.getAttribute("data-target")); t.outerHTML = ""; for (var a = { success: !1, files: [] }, r = list.querySelectorAll("li"), i = 0; i < r.length; i++) { var l = {}, d = r[i].getAttribute("id"); l.hash = d, l.name = document.getElementById(d + "-name").innerHTML, l.url = document.getElementById(d + "-link").getAttribute("href"), a.files.push(l) } n(a, !0) }), i.appendChild(d), l.appendChild(document.createTextNode(e.files[t].name)), i.appendChild(l), r.appendChild(i), r.appendChild(u), r.setAttribute("id", a), list.appendChild(r) } }(e), n(e, !1)) : (console.log("Error, couldn't parse data as JSON."), a(e)) } catch (t) { console.log("Error, something went wrong while parsing data as JSON.", t), a(e) } else 404 != i.status && 500 != i.status || (console.log("Error, status code", i.status), a(e)) }, i.open(t.method, t.action), i.send(r) }) }();
